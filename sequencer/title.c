/*
 * Copyright (c) 2012-2016 Israel Jacquez
 * See LICENSE for details.
 *
 * Israel Jacquez <mrkotfw@gmail.com>
 */

#include <yaul.h>

#include "sequencer.h"
#include "scenes.h"

static uint32_t *backscreen_tb = (uint32_t *)VRAM_ADDR_4MBIT(0, 0x0);
const uint16_t backscreen[240] = {
	//rasters colors in BGR15
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0800, 0x0800, 0x0800, 0x0800, 0x0400, 0x1000, 0x1000, 0x1000, 0x1000, 
	0x0C00, 0x1800, 0x1800, 0x1800, 0x1800, 0x1800, 0x2000, 0x2000, 0x2000, 0x2000, 0x2800, 0x2800, 0x2800, 0x2800, 0x3400, 0x3000, 
	0x3000, 0x3000, 0x3C00, 0x3800, 0x3800, 0x4400, 0x4000, 0x4000, 0x4C00, 0x4C00, 0x4800, 0x5400, 0x5000, 0x5C00, 0x5800, 0x6400, 
	0x6C00, 0x7400, 0x7C00, 0x7C40, 0x7C80, 0x7CC0, 0x7D00, 0x7D40, 0x7D80, 0x7DC0, 0x7E00, 0x7E60, 0x7EA0, 0x7EE0, 0x7F20, 0x7F60, 
	0x7FA0, 0x7FE0, 0x3DE0, 0x4220, 0x41C0, 0x41E0, 0x4180, 0x41A0, 0x4140, 0x4140, 0x4100, 0x4100, 0x40C0, 0x40C0, 0x4060, 0x4080, 
	0x4020, 0x4040, 0x4000, 0x4400, 0x3800, 0x3C00, 0x3000, 0x3400, 0x2800, 0x2800, 0x2800, 0x2000, 0x2000, 0x2000, 0x1800, 0x1800, 
	0x1800, 0x0C00, 0x1000, 0x1000, 0x1000, 0x0400, 0x0800, 0x0800, 0x0800, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000
};

void title_init(void)
{
    struct vram_ctl *vram_ctl;
        
    /* We want to be in VBLANK-IN (retrace) */
    vdp2_tvmd_display_clear();        
    
    /* Copy rasters bars color data to VRAM */
    memcpy(backscreen_tb, backscreen, sizeof(backscreen));   
    
    /* set BKTAL and BKTAU (Back screen table address register */
    MEMORY_WRITE(16, VDP2(BKTAL), ( ( (uint32_t) backscreen_tb >> 1) & 0x0FFFF) );
    MEMORY_WRITE(16, VDP2(BKTAU), (0x8000 | ( ((uint32_t) backscreen_tb >> 17) & 0x7)));      
        
    // 16 colors bitmap requires 1 access each
    vram_ctl = vdp2_vram_control_get();
    vram_ctl->vram_cycp.pt[0].t7 = VRAM_CTL_CYCP_NO_ACCESS;
    vram_ctl->vram_cycp.pt[0].t6 = VRAM_CTL_CYCP_NO_ACCESS; 
    vram_ctl->vram_cycp.pt[0].t5 = VRAM_CTL_CYCP_NO_ACCESS; 
    vram_ctl->vram_cycp.pt[0].t4 = VRAM_CTL_CYCP_NO_ACCESS;
    vram_ctl->vram_cycp.pt[0].t3 = VRAM_CTL_CYCP_NO_ACCESS;
    vram_ctl->vram_cycp.pt[0].t2 = VRAM_CTL_CYCP_NO_ACCESS;
    vram_ctl->vram_cycp.pt[0].t1 = VRAM_CTL_CYCP_NO_ACCESS;
    vram_ctl->vram_cycp.pt[0].t0 = VRAM_CTL_CYCP_NO_ACCESS;

    vram_ctl->vram_cycp.pt[1].t7 = VRAM_CTL_CYCP_NO_ACCESS;
    vram_ctl->vram_cycp.pt[1].t6 = VRAM_CTL_CYCP_NO_ACCESS;
    vram_ctl->vram_cycp.pt[1].t5 = VRAM_CTL_CYCP_NO_ACCESS;
    vram_ctl->vram_cycp.pt[1].t4 = VRAM_CTL_CYCP_NO_ACCESS;
    vram_ctl->vram_cycp.pt[1].t3 = VRAM_CTL_CYCP_NO_ACCESS;
    vram_ctl->vram_cycp.pt[1].t2 = VRAM_CTL_CYCP_NO_ACCESS;
    vram_ctl->vram_cycp.pt[1].t1 = VRAM_CTL_CYCP_NO_ACCESS;
    vram_ctl->vram_cycp.pt[1].t0 = VRAM_CTL_CYCP_NO_ACCESS;
    vdp2_vram_control_set(vram_ctl);   
                        
    vdp2_tvmd_display_set();    

#ifdef DEBUG    
    cons_write(&cons, "[07;2HIniting Title");      
#endif 
}

void title_update(void)
{
#ifdef DEBUG
    cons_write(&cons, "[08;2HUpdating Title");  
#endif    
}

void title_draw(void)
{
    vdp2_scrn_display_clear();
#ifdef DEBUG
    cons_write(&cons, "[09;2HDrawing Title"); 
#endif
}

void title_exit(void)
{
#ifdef DEBUG
    cons_write(&cons, "[10;2HDesinit Title");  
#endif 
    vdp2_scrn_display_clear();
}